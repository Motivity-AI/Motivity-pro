<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motivity AI Master | منصة هندسة الصوت</title>
    <meta property="og:title" content="Motivity AI Master">
    <meta property="og:description" content="النظام الذكي لمحاكاة وتصميم الأنظمة الصوتية - Motivity 2026">
    <style>
        :root { --red: #e60012; --dark: #020617; --panel: #0f172a; --blue: #38bdf8; --green: #10b981; }
        body { margin: 0; display: flex; flex-direction: row; height: 100vh; background: var(--dark); color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; }
        
        /* التجاوب مع الهواتف */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; }
            .sidebar { width: 100% !important; height: auto !important; border-left: none !important; border-bottom: 3px solid var(--red); }
            canvas { height: 300px !important; }
        }

        .sidebar { width: 400px; background: var(--panel); padding: 15px; overflow-y: auto; border-left: 3px solid var(--red); z-index: 10; }
        .logo-container { text-align: center; margin-bottom: 15px; background: #000; padding: 15px; border-radius: 8px; border: 1px solid #334155; }
        .logo-text { font-size: 28px; font-weight: 900; color: #fff; letter-spacing: 2px; margin: 0; text-transform: uppercase; }
        .logo-text span { color: var(--red); }

        .box { background: #1e293b; padding: 12px; border-radius: 8px; margin-bottom: 12px; border-right: 4px solid var(--red); }
        h3 { margin: 0 0 8px; font-size: 13px; color: var(--blue); border-bottom: 1px solid #475569; padding-bottom: 5px; }
        label { font-size: 11px; color: #94a3b8; display: block; margin-top: 5px; }
        select, input { width: 100%; padding: 8px; background: #020617; border: 1px solid #475569; color: #fff; border-radius: 4px; margin-top: 3px; font-size: 12px; outline: none; }
        
        .viewport { flex: 1; display: flex; flex-direction: column; background: #000; position: relative; }
        canvas { flex: 1; margin: 10px; background: #0f172a; border: 1px solid #334155; border-radius: 4px; cursor: crosshair; }

        .dashboard { height: 80px; background: #000; border-top: 2px solid var(--red); display: grid; grid-template-columns: repeat(4, 1fr); align-items: center; text-align: center; }
        .stat-v { font-size: 18px; font-weight: bold; color: var(--red); display: block; }
        .stat-l { font-size: 9px; color: #94a3b8; text-transform: uppercase; }

        .btn { background: var(--red); border: none; color: #fff; width: 100%; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 8px; font-size: 13px; transition: 0.3s; }
        .btn:hover { background: #ff1a1a; transform: translateY(-2px); }
        .btn-ai { background: #7c3aed; margin-top: 15px; }
        .btn-report { background: var(--green); }

        .item-row { background: #0f172a; padding: 8px; border-radius: 4px; margin-top: 5px; border: 1px solid #1e293b; font-size: 11px; display: flex; justify-content: space-between; align-items: center; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        .del { color: #ef4444; cursor: pointer; font-weight: bold; padding: 0 5px; }

        #reportOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; color:#000; z-index:9999; padding:20px; overflow-y:auto; }
        @media print { .no-print { display: none !important; } #reportOverlay { position: relative; padding: 0; } }
    </style>
</head>
<body>

<div class="sidebar no-print">
    <div class="logo-container">
        <h1 class="logo-text">MOTI<span>V</span>ITY</h1>
        <small style="color: #64748b; font-size: 10px;">AI SOUND ENGINEERING SYSTEM</small>
    </div>

    <div class="box">
        <h3>1. تهيئة الموقع</h3>
        <div style="display:flex; gap:5px;">
            <div style="flex:1;"><label>العرض (م)</label><input type="number" id="vW" value="30" oninput="render()"></div>
            <div style="flex:1;"><label>الطول (م)</label><input type="number" id="vL" value="50" oninput="render()"></div>
        </div>
        <label>نوع البيئة</label>
        <select id="env_type" onchange="render()">
            <option value="indoor">قاعة احتفالات مغلقة</option>
            <option value="outdoor">مساحة فعاليات مفتوحة</option>
        </select>
    </div>

    <div class="box">
        <h3>2. إضافة الوحدات الصوتية</h3>
        <label>منطقة التوزيع (Zone)</label>
        <select id="sel_zone">
            <option value="z1">المسرح (Monitor Zone)</option>
            <option value="z2">الجمهور (Front PA)</option>
            <option value="z3">منتصف القاعة (Mid Fill)</option>
            <option value="z4">تغطية بعيدة (Delay Line 1)</option>
            <option value="z5">أقصى الخلف (Delay Line 2)</option>
        </select>
        
        <label>الموديل الهندسي</label>
        <select id="sel_model">
           <optgroup label="HD Series (Active)">
               <option value="HD Sub18">HD Sub18 Active (1200W)</option>
               <option value="HD315A">HD315A Active (1000W)</option>
               <option value="HD312A">HD312A Active (1000W)</option>
           </optgroup>
           <optgroup label="3G Series">
               <option value="DB25-3G">DB25-3G Passive (1000W)</option>
               <option value="DB218-3G">DB218-3G Sub (1600W)</option>
               <option value="DB15M-3G">DB15M-3G Monitor (500W)</option>
           </optgroup>
           <optgroup label="MLA Line Array">
               <option value="MLA-212">MLA-212 Array Top (900W)</option>
               <option value="MLA-210">MLA-210 Array Top (700W)</option>
               <option value="MLA-25B">MLA-25B Array Sub (1000W)</option>
           </optgroup>
           <optgroup label="QX Series">
               <option value="QX-218">QX-218 Passive Sub (1400W)</option>
           </optgroup>
        </select>

        <label>الكمية</label>
        <input type="number" id="sel_qty" value="2" min="1">
        <button class="btn" onclick="addItem()">تثبيت في المخطط</button>
    </div>

    <div id="items_list"></div>

    <div style="margin-top:auto">
        <button class="btn btn-ai" onclick="aiSuggest()">✨ تصميم ذكي تلقائي</button>
        <button class="btn btn-report" onclick="showReport()">استخراج التقرير الفني</button>
    </div>
</div>

<div class="viewport no-print">
    <canvas id="cv"></canvas>
    <div class="dashboard">
        <div><span class="stat-v" id="d_watt">0 W</span><span class="stat-l">RMS Power</span></div>
        <div><span class="stat-v" id="d_qty">0</span><span class="stat-l">Units</span></div>
        <div><span class="stat-v" id="d_spl">0 dB</span><span class="stat-l">Peak SPL</span></div>
        <div><span class="stat-v" id="d_status" style="color:#666">---</span><span class="stat-l">Coverage</span></div>
    </div>
</div>

<div id="reportOverlay">
    <div id="reportContent"></div>
    <div class="no-print" style="max-width:900px; margin: 20px auto; display:flex; gap:10px">
        <button class="btn" style="background:var(--green); flex:1" onclick="window.print()">حفظ كـ PDF / طباعة</button>
        <button class="btn" style="background:#666; flex:1" onclick="document.getElementById('reportOverlay').style.display='none'">إغلاق التقرير</button>
    </div>
</div>

<script>
    const catalog = {
        "HD Sub18": {w: 1200, r: 40}, "HD315A": {w: 1000, r: 45}, "HD312A": {w: 1000, r: 40},
        "DB25-3G": {w: 1000, r: 40}, "DB218-3G": {w: 1600, r: 35}, "DB15M-3G": {w: 500, r: 15},
        "MLA-212": {w: 900, r: 55}, "MLA-210": {w: 700, r: 50}, "MLA-25B": {w: 1000, r: 40},
        "QX-218": {w: 1400, r: 35}
    };

    let items = [];

    function addItem() {
        items.push({ zone: sel_zone.value, model: sel_model.value, qty: parseInt(sel_qty.value) });
        updateUI(); render();
    }

    function aiSuggest() {
        items = [];
        const L = +vL.value;
        if (L > 40) {
            items.push({zone:'z1', model:'DB15M-3G', qty:4}, {zone:'z2', model:'MLA-212', qty:8}, {zone:'z2', model:'QX-218', qty:4}, {zone:'z3', model:'MLA-210', qty:4}, {zone:'z5', model:'MLA-210', qty:2});
        } else {
            items.push({zone:'z1', model:'DB15M-3G', qty:2}, {zone:'z2', model:'HD315A', qty:4}, {zone:'z2', model:'HD Sub18', qty:2});
        }
        updateUI(); render();
    }

    function updateUI() {
        items_list.innerHTML = items.map((it, i) => `
            <div class="item-row">
                <span><strong>${it.zone}</strong>: ${it.model} (x${it.qty})</span>
                <span class="del" onclick="items.splice(${i},1);updateUI();render()">✕</span>
            </div>`).join('');
    }

    function render() {
        const c = cv, x = c.getContext("2d");
        c.width = c.parentElement.clientWidth; c.height = c.parentElement.clientHeight - 80;
        const W = +vW.value, L = +vL.value;
        const scale = Math.min(c.width / W, c.height / L) * 0.8;
        const ox = (c.width - W * scale) / 2, oy = (c.height - L * scale) / 2;

        x.clearRect(0, 0, c.width, c.height);
        x.fillStyle = "#0f172a"; x.fillRect(ox, oy, W * scale, L * scale);
        x.strokeStyle = "#334155"; x.strokeRect(ox, oy, W * scale, L * scale);

        let tW = 0, tQ = 0, covA = 0;
        const colors = {z1:"#22c55e", z2:"#0ea5e9", z3:"#facc15", z4:"#fb923c", z5:"#a855f7"};

        items.forEach(it => {
            const sp = catalog[it.model];
            tW += (sp.w * it.qty); tQ += it.qty;
            for(let i=0; i<it.qty; i++) {
                let px, py;
                let f = it.zone==='z1' ? 0.05 : it.zone==='z2' ? 0.2 : it.zone==='z3' ? 0.45 : it.zone==='z4' ? 0.7 : 0.9;
                px = (i%2==0)? ox + 20 : ox + (W*scale) - 30;
                py = oy + (L*scale*f);
                
                x.shadowBlur = 10; x.shadowColor = colors[it.zone];
                x.fillStyle = colors[it.zone]; x.fillRect(px, py, 10, 10);
                x.shadowBlur = 0;

                let r = sp.r * scale * 0.3;
                let g = x.createRadialGradient(px+5, py+5, 0, px+5, py+5, r);
                g.addColorStop(0, colors[it.zone]+"44"); g.addColorStop(1, "transparent");
                x.fillStyle = g; x.beginPath(); x.arc(px+5, py+5, r, 0, 7); x.fill();
                covA += (Math.PI * r * r);
            }
        });

        d_watt.innerText = tW.toLocaleString() + " W";
        d_qty.innerText = tQ;
        d_spl.innerText = tW > 0 ? Math.round(110 + 10*Math.log10(tW/1000)) + " dB" : "0 dB";
        const ratio = (covA / (W*L*scale*scale)) * 100;
        d_status.innerText = ratio > 60 ? "احترافية" : (ratio > 20 ? "جيدة" : "تحتاج تدعيم");
        d_status.style.color = ratio > 60 ? "#22c55e" : "orange";
    }

    function showReport() {
        const content = document.getElementById('reportContent');
        content.innerHTML = `
            <div style="direction:rtl; padding:20px; border:2px solid #000;">
                <h1 style="text-align:center; font-size:40px; margin:0;">MOTIVITY AUDIO</h1>
                <p style="text-align:center; border-bottom:2px solid red;">نظام المحاكاة الهندسي - تقرير المشروع</p>
                <div style="display:flex; justify-content:space-between; margin:20px 0; background:#f4f4f4; padding:10px;">
                    <span><strong>الأبعاد:</strong> ${vW.value}م × ${vL.value}م</span>
                    <span><strong>القدرة الإجمالية:</strong> ${d_watt.innerText}</span>
                    <span><strong>عدد السماعات:</strong> ${d_qty.innerText}</span>
                </div>
                <center><img src="${cv.toDataURL()}" style="width:100%; max-width:700px; border:1px solid #ddd;"></center>
                <table style="width:100%; border-collapse:collapse; margin-top:20px;" border="1">
                    <thead><tr style="background:#eee;"><th>المنطقة</th><th>الموديل</th><th>الكمية</th></tr></thead>
                    <tbody>${items.map(it => `<tr><td style="padding:8px;">${it.zone}</td><td>${it.model}</td><td>${it.qty}</td></tr>`).join('')}</tbody>
                </table>
                <p style="font-size:12px; margin-top:30px; color:#666;">* هذا التصميم تم إنشاؤه بواسطة تطبيق Motivity AI Master كمرجع هندسي لتوزيع الصوت.</p>
            </div>`;
        document.getElementById('reportOverlay').style.display = 'block';
    }
    render();
    window.onresize = render;
</script>
</body>
</html>