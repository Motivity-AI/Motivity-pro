<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Motivity AI Pro | النظام الهندسي المتكامل</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --red: #e60012; --blue: #38bdf8; --dark: #0a0c10; --panel: #161b22; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { margin: 0; display: flex; height: 100vh; background: var(--dark); color: #fff; overflow: hidden; }

        .sidebar { width: 440px; min-width: 440px; background: var(--panel); border-left: 3px solid var(--red); overflow-y: auto; padding: 20px; }
        .viewport { flex: 1; display: flex; flex-direction: column; background: #000; position: relative; }

        .box { background: #1c2128; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #30363d; }
        h3 { margin: 0 0 10px; font-size: 14px; color: var(--blue); border-bottom: 1px solid #333; padding-bottom: 5px; }
        label { font-size: 11px; color: #8b949e; display: block; margin-top: 8px; }
        select, input { width: 100%; padding: 10px; background: #0d1117; border: 1px solid #30363d; color: #fff; border-radius: 6px; margin-top: 5px; font-size: 13px; }

        #mainCanvas { flex: 1; background: radial-gradient(circle, #1a1f26 0%, #000 100%); width: 100%; height: 100%; }

        .dashboard { height: 90px; background: #000; border-top: 2px solid var(--red); display: grid; grid-template-columns: repeat(4, 1fr); align-items: center; text-align: center; }
        .stat-v { font-size: 20px; font-weight: 900; color: var(--red); display: block; }
        .stat-l { font-size: 10px; color: #8b949e; text-transform: uppercase; }

        .btn { border: none; color: #fff; width: 100%; padding: 14px; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-add { background: var(--red); box-shadow: 0 4px 15px rgba(230,0,18,0.2); }
        .btn-report { background: #238636; }

        #reportOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:9999; padding:20px; overflow-y:auto; }
        .report-paper { background:#fff; width:100%; max-width:900px; margin: 0 auto; padding:40px; color: #000; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; font-size: 13px; }
        th { background: #111; color: #fff; }
    </style>
</head>
<body>

<div class="sidebar">
    <div style="text-align:center; padding-bottom:15px;">
        <h2 style="margin:0; font-size:28px;">MOTIVITY <span style="color:var(--red)">AI</span></h2>
        <small style="color:#666">Professional Audio Systems - 2026</small>
    </div>

    <div class="box">
        <h3>1. تهيئة الموقع والمسرح</h3>
        <label>نوع المساحة:</label>
        <select id="space_type" onchange="draw()">
            <option value="closed">قاعة مغلقة (Indoor +3dB)</option>
            <option value="open">مساحة مفتوحة (Outdoor)</option>
        </select>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div><label>عرض القاعة (m)</label><input type="number" id="hW" value="30" oninput="draw()"></div>
            <div><label>طول القاعة (m)</label><input type="number" id="hL" value="50" oninput="draw()"></div>
            <div><label>عرض المسرح (m)</label><input type="number" id="sW" value="14" oninput="draw()"></div>
            <div><label>عمق المسرح (m)</label><input type="number" id="sL" value="7" oninput="draw()"></div>
        </div>
    </div>

    <div class="box">
        <h3>2. الأقسام الستة والمنتجات</h3>
        <label>القسم:</label>
        <select id="zone">
            <option value="Main PA">1. الأطراف الرئيسية (Main PA)</option>
            <option value="Subs">2. مصفوفة القواعد (Subs Array)</option>
            <option value="FrontFill">3. تغطية أمامية (Front Fill)</option>
            <option value="Monitors">4. المسرح (Monitors)</option>
            <option value="SideFill">5. الجوانب (Side Fill)</option>
            <option value="Delay">6. خط التأخير (Delay Line)</option>
        </select>

        <label>الموديل المحدث:</label>
        <select id="sel_model">
            <optgroup label="HD Series (Active)">
                <option value="HD Sub18|1200">HD Sub18 Active (1200W)</option>
                <option value="HD315A|1000">HD315A Active (1000W)</option>
                <option value="HD312A|1000">HD312A Active (1000W)</option>
            </optgroup>
            <optgroup label="3G Series">
                <option value="DB25-3G|1000">DB25-3G Full Range (1000W)</option>
                <option value="MTL-700 3G|700">MTL-700 3G (700W)</option>
                <option value="DB15M-3G|500">DB15M-3G Monitor (500W)</option>
                <option value="DB218-3G|1600">DB218-3G Subwoofer (1600W)</option>
            </optgroup>
            <optgroup label="QX Series">
                <option value="QX-218|1400">QX-218 Subwoofer (1400W)</option>
                <option value="QX-118|700">QX-118 Subwoofer (700W)</option>
            </optgroup>
            <optgroup label="M Series-Line Array">
                <option value="M-25BW|1000">M-25BW Array Sub (1000W)</option>
                <option value="M-10|700">M-10 Array Top (700W)</option>
            </optgroup>
            <optgroup label="Traditional DB">
                <option value="DB-25NW|1000">DB-25NW Passive (1000W)</option>
                <option value="MTL-152|600">MTL-152 Passive (600W)</option>
                <option value="DB-10|200">DB-10 Passive (200W)</option>
                <option value="DB-25OW|1000">DB-25OW Passive (1000W)</option>
            </optgroup>
            <optgroup label="MLA Series-Line Array">
                <option value="MLA-25B|1000">MLA-25B Array Sub (1000W)</option>
                <option value="MLA-210|700">MLA-210 Array Top (700W)</option>
                <option value="MLA-212|900">MLA-212 Array Top (900W)</option>
            </optgroup>
        </select>

        <label>الكمية (عدد النقاط):</label>
        <input type="number" id="qty" value="4" min="1">
        <button class="btn btn-add" onclick="addItem()">إضافة للنظام</button>
    </div>

    <div id="ui_list"></div>
    <button class="btn btn-report" onclick="openReport()">إصدار التقرير الشامل</button>
</div>

<div class="viewport">
    <canvas id="mainCanvas"></canvas>
    <div class="dashboard">
        <div><span class="stat-v" id="d_w">0 W</span><span class="stat-l">TOTAL RMS</span></div>
        <div><span class="stat-v" id="d_q">0</span><span class="stat-l">TOTAL UNITS</span></div>
        <div><span class="stat-v" id="d_s">0 dB</span><span class="stat-l">EST. MAX SPL</span></div>
        <div><span class="stat-v" id="d_e" style="color:var(--blue)">-</span><span class="stat-l">ENVIRONMENT</span></div>
    </div>
</div>

<div id="reportOverlay">
    <div class="report-paper">
        <h1 style="border-bottom:5px solid #000; padding-bottom:10px;">MOTIVITY ENGINEERING REPORT</h1>
        <div id="repInfo" style="margin:20px 0; font-weight:bold; background:#f4f4f4; padding:15px; border-right:5px solid var(--red);"></div>
        <div style="background:#000; padding:10px; text-align:center;"><img id="repImg" style="width:100%;"></div>
        <table id="repTable"></table>
        <button class="btn" style="background:#000; width:150px; margin-top:20px;" onclick="document.getElementById('reportOverlay').style.display='none'">رجوع</button>
    </div>
</div>

<script>
    let sys = [];
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');

    function addItem() {
        const [m, w] = document.getElementById('sel_model').value.split('|');
        sys.push({ z: document.getElementById('zone').value, m: m, w: parseInt(w), q: parseInt(document.getElementById('qty').value) });
        updateUI(); draw();
    }

    function updateUI() {
        document.getElementById('ui_list').innerHTML = sys.map((s, i) => `
            <div style="background:#0d1117; padding:8px; border-radius:6px; margin:5px 15px; border:1px solid #333; font-size:11px; display:flex; justify-content:space-between;">
                <span><b>${s.z}</b>: ${s.m} (x${s.q})</span>
                <b style="color:red; cursor:pointer" onclick="sys.splice(${i},1);updateUI();draw()">×</b>
            </div>`).join('');
    }

    function draw() {
        canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        const hW = parseFloat(document.getElementById('hW').value), hL = parseFloat(document.getElementById('hL').value);
        const sW = parseFloat(document.getElementById('sW').value), sL = parseFloat(document.getElementById('sL').value);
        const scale = Math.min((canvas.width-80)/hW, (canvas.height-120)/hL);
        const ox = (canvas.width - hW*scale)/2, oy = (canvas.height - hL*scale)/2;

        ctx.fillStyle = "#05070a"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = "#333"; ctx.lineWidth = 2; ctx.strokeRect(ox, oy, hW*scale, hL*scale);

        const sx = ox + (hW*scale - sW*scale)/2;
        ctx.fillStyle = "rgba(56, 189, 248, 0.1)"; ctx.fillRect(sx, oy, sW*scale, sL*scale);
        ctx.strokeStyle = "#38bdf8"; ctx.strokeRect(sx, oy, sW*scale, sL*scale);

        sys.forEach(s => {
            const col = { "Main PA":"#ff0000", "Subs":"#ffffff", "FrontFill":"#ffff00", "Monitors":"#00d4ff", "SideFill":"#00ff00", "Delay":"#ff8800" }[s.z];
            for(let i=0; i<s.q; i++) {
                let px, py; const half = Math.ceil(s.q/2);
                if(s.z === "Main PA") {
                    px = (i < half) ? sx - 15 : sx + sW*scale + 5;
                    py = oy + (sL*scale) + (i % half) * 20;
                } else if(s.z === "Subs" || s.z === "FrontFill") {
                    px = sx + (sW*scale / (s.q + 1)) * (i + 1);
                    py = (s.z === "Subs") ? oy + sL*scale + 12 : oy + sL*scale - 12;
                } else if(s.z === "Monitors") {
                    px = sx + (sW*scale / (s.q + 1)) * (i + 1);
                    py = oy + sL*scale * 0.7;
                } else if(s.z === "SideFill") {
                    px = (i < half) ? ox + 15 : ox + hW*scale - 25;
                    py = oy + (hL*scale * 0.45) + (i % half) * 20;
                } else { // Delay
                    px = (i < half) ? ox + 15 : ox + hW*scale - 25;
                    py = oy + (hL*scale * 0.8) + (i % half) * 20;
                }
                ctx.beginPath(); ctx.arc(px, py, 4, 0, Math.PI*2);
                ctx.fillStyle = col; ctx.shadowBlur = 10; ctx.shadowColor = col; ctx.fill(); ctx.shadowBlur = 0;
            }
        });

        let tw = sys.reduce((a,b) => a + (b.w*b.q), 0);
        document.getElementById('d_w').innerText = tw.toLocaleString() + " W";
        document.getElementById('d_q').innerText = sys.reduce((a,b) => a+b.q, 0);
        document.getElementById('d_e').innerText = document.getElementById('space_type').value.toUpperCase();
        let spl = tw > 0 ? Math.round(112 + 10*Math.log10(tw/1000)) : 0;
        if(document.getElementById('space_type').value==='closed') spl += 3;
        document.getElementById('d_s').innerText = spl + " dB";
    }

    function openReport() {
        document.getElementById('repImg').src = canvas.toDataURL();
        document.getElementById('repInfo').innerText = `المساحة: ${document.getElementById('hW').value}x${document.getElementById('hL').value}م | المسرح: ${document.getElementById('sW').value}x${document.getElementById('sL').value}م | الحالة: ${document.getElementById('space_type').value}`;
        document.getElementById('repTable').innerHTML = `<tr><th>القسم</th><th>الموديل</th><th>الكمية</th><th>RMS Total</th></tr>` +
            sys.map(s => `<tr><td>${s.z}</td><td>${s.m}</td><td>${s.q}</td><td>${(s.w*s.q).toLocaleString()} W</td></tr>`).join('');
        document.getElementById('reportOverlay').style.display='block';
    }
    window.onload = () => setTimeout(draw, 500);
</script>
</body>
</html>
